import c from"node:path";import{URL as p}from"node:url";import{app as r,BrowserWindow as h}from"electron";import d from"node:fs";import{createServer as m}from"node:http";import f from"node:path";import{createRpcProxy as u,setElectronProxyContext as v}from"@vue/devtools-kit";import{createApp as w,eventHandler as y,toNodeListener as S}from"h3";import{Server as g}from"socket.io";var s=process.env.PORT||8098;function l(){let n=w();n.use("/",y(()=>"if(!window.process){window.process={env:{}}};"+d.readFileSync(f.join(__dirname,"./user-app.iife.js"),"utf-8")));let t=m(S(n));new g(t,{cors:{origin:!0}}).on("connection",o=>{v(o),u({preset:"electron"}),o.broadcast.emit("vue-devtools:disconnect-user-app"),o.on("vue-devtools:init",()=>{o.broadcast.emit("vue-devtools:init")}),o.on("vue-devtools:disconnect",()=>{o.broadcast.emit("vue-devtools:disconnect")}),o.on("disconnect",i=>{i.indexOf("client")&&o.broadcast.emit("vue-devtools-disconnect-devtools")})}),t.listen(s,()=>{console.log(`listening on 0.0.0.0:${s}`)})}l();var e=null;function a(){e=new h({width:800,height:600,icon:c.join(__dirname,"../icons/128.png"),webPreferences:{webSecurity:!1,nodeIntegration:!0,contextIsolation:!1,devTools:!1}});let n=c.join(__dirname,"../app.html"),t=new p(`file://${n}`).toString();e.setMenu(null),e.loadURL(new p(t).toString()),e.on("closed",()=>{e=null})}r.on("ready",a);r.on("window-all-closed",()=>{process.platform!=="darwin"&&r.quit()});r.on("activate",()=>{e===null&&a()});
